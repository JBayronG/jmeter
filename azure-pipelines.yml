trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
# 1️⃣ Checkout del repo (explícito)
- checkout: self
  fetchDepth: 1

# 2️⃣ Instalar JMeter
- script: |
    sudo apt-get update
    sudo apt-get install -y jmeter
    jmeter -v
  displayName: 'Instalar JMeter'

# 3️⃣ Ejecutar prueba de performance
- script: |
    mkdir -p results
    jmeter -n \
      -t guru99v2.jmx \
      -l results/results.jtl \
      -e -o results/html
  displayName: 'Ejecutar prueba JMeter'

# 4️⃣ Publicar resultados como artefacto
- task: PublishPipelineArtifact@1
  inputs:
    targetPath: 'results'
    artifact: 'jmeter-results'
    publishLocation: 'pipeline'
  condition: always()